<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carta Santa</title>
  <style>
    /* ---------------------------------- */
    /* ESTILOS GENERALES Y LAYOUT */
    /* ---------------------------------- */
    body { font-family: sans-serif; background: #f8f5f0; margin: 0; padding-bottom: 80px; }
    .section { padding: 24px 15px; max-width: 700px; margin: auto; }
    .item { 
        display: flex; justify-content: space-between; align-items: flex-start; 
        padding: 12px 0; border-bottom: 1px solid #eee; 
    }
    .item strong:last-child { font-size: 16px; color: #222; margin-left: 10px; flex-shrink: 0; }
    .description { font-size: 13px; color: #777; margin: 4px 0 8px 0; }
    .add-btn { 
        padding: 6px 10px; background: #17a2b8; color: #fff; border: none; 
        border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: bold;
        margin-top: 10px; /* Para separarlo de las opciones */
    }
    .section h2 { text-align: center; margin-bottom: 16px; border-bottom: 2px solid #555; padding-bottom: 6px; font-weight: bold; }

    /* ---------------------------------- */
    /* NAVEGACI√ìN (HAMBURGUESA) */
    /* ---------------------------------- */
    header { 
        background: #ffffffcc; position: sticky; top: 0; backdrop-filter: blur(8px); 
        padding: 12px; border-bottom: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
        z-index: 10; display: flex; justify-content: space-between; align-items: center;
    }
    #menuBtn { font-size: 24px; background: none; border: none; cursor: pointer; color: #333; padding: 0 10px; }
    #menuNav { 
        position: fixed; top: 0; left: -250px; width: 250px; height: 100%; 
        background: #fff; z-index: 20; padding-top: 50px; box-shadow: 2px 0 5px rgba(0,0,0,0.5); 
        transition: left 0.3s; 
    }
    #menuNav.open { left: 0; }
    #menuNav a { 
        display: block; padding: 10px 20px; text-decoration: none; color: #333; 
        border-bottom: 1px solid #eee; 
    }
    #closeMenuBtn { position: absolute; top: 10px; right: 10px; font-size: 24px; cursor: pointer; }

    /* ---------------------------------- */
    /* BOT√ìN FLOTANTE FINALIZAR COMPRA */
    /* ---------------------------------- */
    #floatBtn {
        position: fixed; bottom: 20px; right: 20px;
        background: #25d366; color: white; padding: 12px 18px; 
        border: none; border-radius: 50px; font-size: 16px; 
        box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 15;
        font-weight: bold; cursor: pointer;
    }
    #cartBadge { background: red; color: white; border-radius: 50%; padding: 2px 6px; margin-left: 8px; font-size: 12px; }

    /* ---------------------------------- */
    /* MODAL DEL CARRITO */
    /* ---------------------------------- */
    #cartModal { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0,0,0,0.7); display: none; z-index: 50;
    }
    #cartContent { 
        position: absolute; bottom: 0; left: 0; right: 0; 
        background: #fff; padding: 20px; border-top-left-radius: 15px; 
        border-top-right-radius: 15px; max-height: 80%; overflow-y: auto;
    }
    .cart-item { 
        display: flex; justify-content: space-between; align-items: center; 
        padding: 8px 0; border-bottom: 1px dashed #ccc; 
    }
    .remove-btn { 
        background: none; border: none; color: #cc0000; cursor: pointer; 
        font-size: 18px; padding: 0 5px; 
    }
    #total { margin-top: 15px; font-size: 18px; font-weight: bold; }
    #sendBtn { 
        width: 100%; padding: 14px; background: #25d366; color: white; 
        border: none; border-radius: 8px; font-size: 16px; cursor: pointer; 
        font-weight: bold; margin-top: 15px;
    }

    /* ESTILOS DEL LOGO */
    #mainLogo {
        height: 35px; 
        width: auto;
    }
  </style>
</head>
<body>
<header>
    <button id="menuBtn" onclick="toggleMenu()">‚ò∞</button>
    <img src="logo santa.png" alt="Logo del Restaurante" id="mainLogo"> 
</header>

<nav id="menuNav">
    <button id="closeMenuBtn" onclick="toggleMenu()">‚úñ</button>
</nav>

<div id="content"></div>

<button id="floatBtn" style="display: none;" onclick="showCartModal()">
    Finalizar Compra <span id="cartBadge">0</span>
</button>

<div id="cartModal" onclick="hideCartModal(event)">
    <div id="cartContent">
        <h3 style="margin-top:0;">üß∫ Tu Pedido</h3>
        <div id="cartItems"></div>
        <div id="total"></div>
        <button id="sendBtn" onclick="sendToWhatsApp()">Enviar Pedido por WhatsApp</button>
        <p style="text-align: center; font-size: 12px; margin-top: 10px; color: #777;">Toca fuera del cuadro para cerrar</p>
    </div>
</div>

<script>
// ===============================================
// 1. CONSTANTES DE OPCIONES Y DATOS DEL MEN√ö
// ===============================================

let cart = [];
let data = {};
const WAPP_NUMBER = '5492235776624';

// Separaci√≥n de Adicionales
const ADICIONALES_COMUNES = [
    { name: "Jam√≥n", price: 3000 },
    { name: "Queso", price: 3000 },
    { name: "Huevo", price: 3000 },
];
const ADICIONALES_PREMIUM = [
    { name: "Gambas", price: 4000 },
    { name: "At√∫n", price: 4000 },
    { name: "Palta", price: 4000 },
    { name: "Palmitos", price: 4000 },
    { name: "Anan√°", price: 4000 },
    { name: "Parmesano", price: 4000 },
    { name: "Queso Azul", price: 4000 }
];

const SANDWICH_PANS = ["√Årabe", "Pebete", "Franc√©s"];
const SANDWICH_CATEGORIES = ['sandwiches-frios', 'sandwiches-calientes', 'vegetarianos'];
const ENSALADA_CATEGORIES = ['ensaladas'];


// ===============================================
// 2. FUNCIONES DE UTILIDAD Y L√ìGICA DE CARRITO
// ===============================================

function formatPrice(price) {
    if (typeof price !== 'number') return `$${price}`;
    return `$${price.toLocaleString('es-AR', { minimumFractionDigits: 0 })}`;
}

function toggleMenu() {
    document.getElementById('menuNav').classList.toggle('open');
}

function showCartModal() {
    document.getElementById('cartModal').style.display = 'block';
}

function hideCartModal(event) {
    if (event.target.id === 'cartModal') {
        document.getElementById('cartModal').style.display = 'none';
    }
}

function removeItem(index) {
    cart.splice(index, 1);
    renderCart();
}

function renderCart() {
    const cartItemsContainer = document.getElementById('cartItems');
    const totalElement = document.getElementById('total');
    const floatBtn = document.getElementById('floatBtn');
    const cartBadge = document.getElementById('cartBadge');
    
    cartItemsContainer.innerHTML = '';
    let total = 0;
    
    if (cart.length === 0) {
        floatBtn.style.display = 'none';
        cartBadge.innerText = '0';
        document.getElementById('cartModal').style.display = 'none';
        return;
    }

    floatBtn.style.display = 'block';

    for (let i = 0; i < cart.length; i++) {
        const item = cart[i];
        total += item.price;
        
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
            <span>${item.name}</span>
            <span>
                <strong>${formatPrice(item.price)}</strong>
                <button class='remove-btn' onclick="removeItem(${i})">X</button>
            </span>
        `;
        cartItemsContainer.appendChild(div);
    }
    
    const item_count = cart.length;
    totalElement.innerHTML = `<strong>Total: ${formatPrice(total)}</strong>`;
    cartBadge.innerText = item_count;
}

function sendToWhatsApp() {
    if (!cart.length) return;
    
    const header = encodeURIComponent("¬°Hola! Me gustar√≠a hacer el siguiente pedido:");
    
    const itemsList = cart.map(item => 
        encodeURIComponent(`- ${item.name} (${formatPrice(item.price)})`)
    ).join("%0A"); 
    
    const total = cart.reduce((sum, item) => sum + item.price, 0);
    const totalMsg = encodeURIComponent(`Total estimado: ${formatPrice(total)}`);
    
    const message = `${header}%0A%0A${itemsList}%0A%0A${totalMsg}%0A%0AGracias!`;
    
    const url = `https://wa.me/${WAPP_NUMBER}?text=${message}`;
    window.open(url, '_blank');
}


// --- L√ìGICA AVANZADA DE OPCIONES ---

function toggleOptions(itemId) {
    const optionsDiv = document.getElementById(`options-${itemId}`);
    const btn = document.getElementById(`btn-options-${itemId}`);
    
    if (optionsDiv.style.display === 'block') {
        optionsDiv.style.display = 'none';
        btn.innerText = '‚ûï Agregar Opciones/Adicionales';
        btn.style.background = '#5a6268';
    } else {
        optionsDiv.style.display = 'block';
        btn.innerText = '‚ûñ Cerrar Opciones';
        btn.style.background = '#dc3545'; // Color de cerrar
    }
}


function resetItemOptions(itemId) {
    // Reset Pan/Tostado
    const panSelect = document.getElementById(`pan-${itemId}`);
    if (panSelect) panSelect.selectedIndex = 0;
    
    const tostadoCheck = document.getElementById(`tostado-${itemId}`);
    if (tostadoCheck) tostadoCheck.checked = false;
    
    // Reset Adicionales
    const adicionalesChecks = document.querySelectorAll(`#adicionales-${itemId} input[type="checkbox"]`);
    adicionalesChecks.forEach(check => check.checked = false);
    
    // Ocultar el panel de opciones
    document.getElementById(`options-${itemId}`).style.display = 'none';
    
    // Restablecer el bot√≥n de opciones
    const btnOptions = document.getElementById(`btn-options-${itemId}`);
    if (btnOptions) {
        btnOptions.innerText = '‚ûï Agregar Opciones/Adicionales';
        btnOptions.style.background = '#5a6268';
    }
}

function prepareAndAddToCart(itemId, baseName, basePrice, categoryId) {
    let finalName = baseName;
    let finalPrice = basePrice;
    let details = [];

    const isSandwich = SANDWICH_CATEGORIES.includes(categoryId);

    // 1. L√≥gica de S√°ndwich (Pan y Tostado)
    if (isSandwich) {
        const panSelect = document.getElementById(`pan-${itemId}`);
        const pan = panSelect ? panSelect.value : '';
        const tostadoCheck = document.getElementById(`tostado-${itemId}`);
        const tostado = tostadoCheck ? tostadoCheck.checked : false;

        if (pan === '' || panSelect.selectedIndex === 0) {
             // Si es un s√°ndwich y no eligi√≥ pan, avisamos y salimos
            alert("Por favor, selecciona una opci√≥n de Pan.");
            return;
        }

        details.push(`Pan: ${pan}`);
        if (tostado) {
            details.push("Tostado: S√≠");
        }
    }

    // 2. L√≥gica de Adicionales
    const adicionalesChecks = document.querySelectorAll(`#adicionales-${itemId} input[type="checkbox"]:checked`);
    let adicionalesList = [];

    adicionalesChecks.forEach(check => {
        const adName = check.value;
        const adPrice = parseInt(check.getAttribute('data-price'));
        finalPrice += adPrice;
        adicionalesList.push(adName);
    });

    if (adicionalesList.length > 0) {
        details.push(`+ ${adicionalesList.join(", ")}`);
    }

    // Construcci√≥n del nombre final para el carrito
    const detailsString = details.length > 0 ? ` [${details.join(" / ")}]` : '';
    const finalItemName = baseName + detailsString;
    
    // A√±adir al carrito con el precio y nombre final
    cart.push({ 
        name: finalItemName, 
        price: finalPrice 
    });
    
    // Limpiar y ocultar las opciones despu√©s de agregar
    resetItemOptions(itemId);
    
    renderCart();
}


// ===============================================
// 3. FUNCIONES DE RENDERIZADO (MEN√ö PRINCIPAL)
// ===============================================

function renderMenu(categories) {
    const nav = document.getElementById('menuNav');
    categories.forEach(cat => {
        const a = document.createElement('a');
        a.href = `#${cat.id}`;
        a.innerText = cat.name;
        a.onclick = toggleMenu; 
        nav.appendChild(a);
    });
}

function renderSections(categories) {
    const content = document.getElementById('content');
    content.innerHTML = ''; 

    categories.forEach(cat => {
        const sec = document.createElement('section');
        sec.className = 'section';
        sec.id = cat.id;
        sec.innerHTML = `<h2>${cat.name}</h2>`;
        
        cat.items.forEach((item, index) => {
            const itemId = `${cat.id}-${index}`;
            let optionsHtml = '';
            let optionsButtonHtml = '';

            const isSandwich = SANDWICH_CATEGORIES.includes(cat.id);
            const isEnsalada = ENSALADA_CATEGORIES.includes(cat.id);
            
            const hasOptions = isSandwich || isEnsalada;

            if (hasOptions) {
                
                // Generar los adicionales seg√∫n la categor√≠a
                let adicionales = [...ADICIONALES_COMUNES]; // Comunes para todos
                if (isEnsalada) {
                    // Si es ensalada, a√±ade los premium (CORREGIDO)
                    adicionales = adicionales.concat(ADICIONALES_PREMIUM);
                }
                
                // --- Generaci√≥n del Panel de Opciones ---
                optionsHtml += `
                    <div id="options-${itemId}" style="display: none; margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 8px;">
                `;

                // 1. Opciones de S√°ndwich (Pan y Tostado)
                if (isSandwich) {
                    optionsHtml += `
                        <div style="margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px dashed #eee;">
                            <strong>ü•ñ Opciones de Pan:</strong><br>
                            <select id="pan-${itemId}" style="padding: 5px; margin-right: 10px; margin-top: 5px;">
                                <option value="" disabled selected>Elegir Pan</option>
                                ${SANDWICH_PANS.map(pan => `<option value="${pan}">${pan}</option>`).join('')}
                            </select>
                            <label style="margin-top: 5px; display: inline-block;">
                                <input type="checkbox" id="tostado-${itemId}"> Tostado
                            </label>
                        </div>
                    `;
                }

                // 2. Opciones de Adicionales
                optionsHtml += `
                    <div style="font-size: 13px;">
                        <strong>Extras:</strong><br>
                        <div id="adicionales-${itemId}" style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px;">
                            ${adicionales.map((ad, adIndex) => `
                                <label style="display: flex; align-items: center; white-space: nowrap;">
                                    <input type="checkbox" name="adicional-${itemId}" value="${ad.name}" data-price="${ad.price}" style="margin-right: 5px;"> ${ad.name}
                                    <small>(${formatPrice(ad.price)})</small>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                    <button class='add-btn' style="width: 100%; margin-top: 15px;" onclick="prepareAndAddToCart('${itemId}', '${item.name.replace(/'/g, "\\'")}', ${item.price}, '${cat.id}')">
                        Agregar ${item.name} al Carrito
                    </button>
                `;
                optionsHtml += `</div>`; // Cierra div de options
                
                // Bot√≥n para mostrar opciones (fuera del panel de opciones)
                optionsButtonHtml = `
                    <button id="btn-options-${itemId}" class='add-btn' style="background: #5a6268; margin-top: 10px;" onclick="toggleOptions('${itemId}')">
                        ‚ûï Agregar Opciones/Adicionales
                    </button>
                `;
            } // Fin de hasOptions


            const div = document.createElement('div');
            div.className = 'item';
            
            // Si NO tiene opciones (platos, bebidas), mostramos el bot√≥n simple de agregar.
            const addToCartBtnHtml = hasOptions ? '' : 
                `<button class='add-btn' onclick="prepareAndAddToCart('${itemId}', '${item.name.replace(/'/g, "\\'")}', ${item.price}, '${cat.id}')">Agregar</button>`;

            // Renderizado final
            div.innerHTML = `
                <div class="item-details">
                    <strong>${item.name}</strong>
                    ${item.description ? `<div class='description'>${item.description}</div>` : ''}
                    
                    ${optionsButtonHtml}
                    ${optionsHtml}
                    
                    ${addToCartBtnHtml}
                </div>
                <strong>${formatPrice(item.price)}</strong>
            `;
            sec.appendChild(div);
        });
        content.appendChild(sec);
    });
}


// ===============================================
// 4. INICIALIZACI√ìN
// ===============================================

// Carga de datos
fetch('products.json')
    .then(res => {
        if (!res.ok) throw new Error('No se pudo cargar products.json');
        return res.json();
    })
    .then(json => {
        data = json;
        renderMenu(json.categories);
        renderSections(json.categories);
    })
    .catch(error => {
        console.error("Error al cargar el JSON:", error);
        document.getElementById('content').innerHTML = "<p style='text-align:center;'>Hubo un error al cargar el men√∫. Aseg√∫rate que el archivo 'products.json' est√© en la misma carpeta.</p>";
    });

// Inicializar el carrito (para el bot√≥n flotante)
renderCart();
</script>
</body>
</html>
